import{a as $,b as C,i as A}from"./catalog-BHeueepV.js";async function G(e,t){let r=document.querySelector("#popup-template");if(!r){const n=window.location.hostname==="localhost",a=n?"":window.location.pathname.split("/")[1],s=n?"/library-popup.html":`/${a}/library-popup.html`;try{const i=await fetch(s);if(!i.ok){console.error(`Popup.html yüklenemedi. Durum: ${i.status}, URL: ${i.url}`);return}const p=await i.text(),g=document.createElement("div");g.innerHTML=p;const l=g.querySelector(".movie-popup-overlay");if(!l){console.error("movie-popup-overlay bulunamadı.");return}l.id="popup-template",document.body.appendChild(l),await I(l,e,t)}catch(i){console.error("Popup yüklenirken bir hata oluştu:",i)}return}const o=r.cloneNode(!0);o.id="",await I(o,e,t)}async function I(e,t,r){e.style.display="flex";const o=e.querySelector(".movie-popup-img");o.src=t.poster_path?`https://image.tmdb.org/t/p/original${t.poster_path}`:"",o.alt=t.title,e.querySelector(".movie-popup-title").textContent=t.title,e.querySelector(".vote-avg").textContent=t.vote_average?.toFixed(1)??"-",e.querySelector(".vote-count").textContent=t.vote_count??"-",e.querySelector(".popularity-value").textContent=t.popularity?.toFixed(1)??"-";let n="-";t.genre_names?.length?n=t.genre_names.join(", "):t.genres?.length?n=t.genres.map(l=>l.name).join(", "):t.genre_ids?.length&&(n=t.genre_ids.map(l=>r[l]||l).join(", ")),e.querySelector(".genre-value").textContent=n,e.querySelector(".about-value").textContent=t.overview||"No description.";const a=e.querySelector(".movie-popup-add-btn.removed");a&&(a.style.display="inline-block",a.onclick=()=>{let l=JSON.parse(localStorage.getItem("library"))||[];l=l.filter(H=>H!==t.id),localStorage.setItem("library",JSON.stringify(l)),v(),window.location.reload()});const s=e.querySelector(".movie-popup-close"),i=window.location.hostname==="localhost",p=i?"":window.location.pathname.split("/")[1],g=i?"":`/${p}`;s.addEventListener("mouseenter",()=>{s.querySelector("img").src=`${g}/img/svg/close-hover.svg`}),s.addEventListener("mouseleave",()=>{s.querySelector("img").src=`${g}/img/svg/close.svg`}),s.addEventListener("click",()=>v()),e.addEventListener("mousedown",l=>{l.target===e&&v()}),document.body.appendChild(e)}function v(){const e=document.querySelector(".movie-popup-overlay")||document.querySelector("#popup-template");e&&e.remove()}const h=document.getElementById("library-film-list"),y=document.getElementById("library-placeholder"),M=document.querySelector(".library-custom-select"),f=document.querySelector(".library-selected-option"),c=document.querySelector(".library-genre-options"),L=document.getElementById("load-more-btn"),b=document.getElementById("library-loading");let m=null,d=[],u=0;const D=9;function _(){M.style.visibility="visible"}function N(){M.style.visibility="hidden"}async function F(){if(m)return m;const e=await C();return m={},e.genres&&Array.isArray(e.genres)&&e.genres.forEach(t=>{m[t.id]=t.name}),m}async function J(){B(),N(),c.classList.add("hidden");const e=JSON.parse(localStorage.getItem("library"))||[];if(e.length===0){y.style.display="flex",h.innerHTML="",S();return}y.style.display="none",h.innerHTML="",m=await F(),d=[];const t=new Set;for(const r of e)try{const o=await $(r);d.push(o),o.genres?.length?o.genres.forEach(n=>t.add(n.id)):o.genre_ids?.length&&o.genre_ids.forEach(n=>t.add(n))}catch(o){console.error(`Film ${r} getirilemedi`,o)}await T([...t],""),u=0,E(),x(),_(),S()}async function T(e,t=""){try{const o=(await C()).genres;if(c.innerHTML="",t){const n=document.createElement("li");n.textContent="Genre",n.dataset.id="",n.addEventListener("click",()=>{f.childNodes[0].nodeValue="Genre",c.classList.add("hidden"),q("")}),c.appendChild(n)}o.forEach(n=>{if(e.includes(n.id)&&n.id!==Number(t)){const a=document.createElement("li");a.textContent=n.name,a.dataset.id=n.id,a.addEventListener("click",()=>{f.childNodes[0].nodeValue=n.name,c.classList.add("hidden"),q(n.id)}),c.appendChild(a)}})}catch(r){console.error("Kategoriler alınamadı:",r)}}async function q(e){B(),N(),c.classList.add("hidden");const t=JSON.parse(localStorage.getItem("library"))||[];if(t.length===0){y.style.display="flex",h.innerHTML="",S();return}y.style.display="none",h.innerHTML="",d=[];const r=Number(e);for(const n of t)try{const a=await $(n),s=a.genres?.map(i=>i.id)||a.genre_ids||[];(!e||s.includes(r))&&d.push(a)}catch(a){console.error(`Film ${n} getirilemedi`,a)}u=0,E(),x(),d.length===0&&(y.style.display="flex");const o=new Set;d.forEach(n=>{n.genres?.length?n.genres.forEach(a=>o.add(a.id)):n.genre_ids?.length&&n.genre_ids.forEach(a=>o.add(a))}),await T([...o],r),_(),S()}function E(){const e=u+D;d.slice(u,e).forEach(r=>{const o=j(r,m);h.appendChild(o)}),u=e}function x(){L&&(L.style.display=u>=d.length?"none":"block")}function j(e,t){const r=document.createElement("li");r.classList.add("library-item");const o=e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",n=e.release_date?.split("-")[0]||"Bilinmiyor",a=e.vote_average||0,s=e.genres?.map(p=>p.name).join(", ")||"Tür bilinmiyor",i=V(a);return r.innerHTML=`
    <img src="${o}" alt="${e.title}" class="library-film-poster" />
    <div class="library-overlay">
      <h3 class="library-film-title">${e.title}</h3>
      <div class="library-bottom-row">
        <p class="library-film-info">${s} | ${n}</p>
        <div class="library-stars">${i}</div>
      </div>
    </div>
  `,r.addEventListener("click",()=>{G(e,t)}),r}const w={full:"./svg/star.svg",half:"./svg/star-half.svg",empty:"./svg/star-outline.svg"};function V(e){const t=Math.floor(e/2),r=e%2>=1?1:0,o=5-t-r;return`<img class="star-icon full" src="${w.full}" alt="star" />`.repeat(t)+`<img class="star-icon half" src="${w.half}" alt="half star" />`.repeat(r)+`<img class="star-icon empty" src="${w.empty}" alt="empty star" />`.repeat(o)}function B(){b&&(b.style.display="block")}function S(){b&&(b.style.display="none")}document.addEventListener("DOMContentLoaded",()=>{console.log("Library JS çalışıyor"),f.childNodes[0].nodeValue="Genre",J();const e=document.getElementById("go-to-catalog");e&&e.addEventListener("click",()=>{window.location.href="catalog.html"}),f.addEventListener("click",()=>{c.classList.toggle("hidden")}),L.addEventListener("click",()=>{E(),x()}),document.addEventListener("click",t=>{t.target.closest(".library-custom-select")||c.classList.add("hidden")})});const R=document.querySelectorAll("[data-theme-option]"),P=document.documentElement,k=localStorage.getItem("theme");k&&P.setAttribute("data-theme",k);R.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-theme-option");P.setAttribute("data-theme",t),localStorage.setItem("theme",t)})});async function K(){const e=document.querySelectorAll("load");for(const t of e){const r=t.getAttribute("src");if(r){const o=await fetch(r);if(o.ok){const n=await o.text(),a=document.createElement("div");a.innerHTML=n,t.replaceWith(a)}else console.error("Partial yüklenemedi:",r)}}}K().then(()=>{A()});
//# sourceMappingURL=main-OMcT84Dg.js.map
