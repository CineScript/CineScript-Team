import{d as $,c as C,i as G}from"./catalog-BnEXCXjM.js";const M=e=>{e.key==="Escape"&&f()};async function D(e,t){let r=document.querySelector("#popup-template");if(!r){const n=window.location.hostname==="localhost",a=n?"":window.location.pathname.split("/")[1],s=n?"/library-popup.html":`/${a}/library-popup.html`;try{const l=await fetch(s);if(!l.ok){console.error(`Popup.html yüklenemedi. Durum: ${l.status}, URL: ${l.url}`);return}const p=await l.text(),y=document.createElement("div");y.innerHTML=p;const i=y.querySelector(".movie-popup-overlay");if(!i){console.error("movie-popup-overlay bulunamadı.");return}i.id="popup-template",document.body.appendChild(i),await x(i,e,t)}catch(l){console.error("Popup yüklenirken bir hata oluştu:",l)}return}const o=r.cloneNode(!0);o.id="",await x(o,e,t)}async function x(e,t,r){e.style.display="flex";const o=e.querySelector(".movie-popup-img");o.src=t.poster_path?`https://image.tmdb.org/t/p/original${t.poster_path}`:"",o.alt=t.title,e.querySelector(".movie-popup-title").textContent=t.title,e.querySelector(".vote-avg").textContent=t.vote_average?.toFixed(1)??"-",e.querySelector(".vote-count").textContent=t.vote_count??"-",e.querySelector(".popularity-value").textContent=t.popularity?.toFixed(1)??"-";let n="-";t.genre_names?.length?n=t.genre_names.join(", "):t.genres?.length?n=t.genres.map(i=>i.name).join(", "):t.genre_ids?.length&&(n=t.genre_ids.map(i=>r[i]||i).join(", ")),e.querySelector(".genre-value").textContent=n,e.querySelector(".about-value").textContent=t.overview||"No description.";const a=e.querySelector(".movie-popup-add-btn.removed");a&&(a.style.display="inline-block",a.onclick=()=>{let i=JSON.parse(localStorage.getItem("library"))||[];i=i.filter(A=>A!==t.id),localStorage.setItem("library",JSON.stringify(i)),f(),window.location.reload()});const s=e.querySelector(".movie-popup-close"),l=window.location.hostname==="localhost",p=l?"":window.location.pathname.split("/")[1],y=l?"":`/${p}`;s.addEventListener("mouseenter",()=>{s.querySelector("img").src=`${y}/img/svg/close-hover.svg`}),s.addEventListener("mouseleave",()=>{s.querySelector("img").src=`${y}/img/svg/close.svg`}),s.addEventListener("click",()=>f()),e.addEventListener("mousedown",i=>{i.target===e&&f()}),document.body.appendChild(e),document.addEventListener("keydown",M)}function f(){const e=document.querySelector(".movie-popup-overlay")||document.querySelector("#popup-template");e&&(e.remove(),document.removeEventListener("keydown",M))}const h=document.getElementById("library-film-list"),g=document.getElementById("library-placeholder"),_=document.querySelector(".library-custom-select"),b=document.querySelector(".library-selected-option"),c=document.querySelector(".library-genre-options"),L=document.getElementById("load-more-btn"),v=document.getElementById("library-loading");let m=null,d=[],u=0;const F=9;function N(){_.style.visibility="visible"}function T(){_.style.visibility="hidden"}async function J(){if(m)return m;const e=await C();return m={},e.genres&&Array.isArray(e.genres)&&e.genres.forEach(t=>{m[t.id]=t.name}),m}async function j(){P(),T(),c.classList.add("hidden");const e=JSON.parse(localStorage.getItem("library"))||[];if(e.length===0){g.style.display="flex",h.innerHTML="",S();return}g.style.display="none",h.innerHTML="",m=await J(),d=[];const t=new Set;for(const r of e)try{const o=await $(r);d.push(o),o.genres?.length?o.genres.forEach(n=>t.add(n.id)):o.genre_ids?.length&&o.genre_ids.forEach(n=>t.add(n))}catch(o){console.error(`Film ${r} getirilemedi`,o)}await B([...t],""),u=0,E(),k(),N(),S()}async function B(e,t=""){try{const o=(await C()).genres;if(c.innerHTML="",t){const n=document.createElement("li");n.textContent="Genre",n.dataset.id="",n.addEventListener("click",()=>{b.childNodes[0].nodeValue="Genre",c.classList.add("hidden"),I("")}),c.appendChild(n)}o.forEach(n=>{if(e.includes(n.id)&&n.id!==Number(t)){const a=document.createElement("li");a.textContent=n.name,a.dataset.id=n.id,a.addEventListener("click",()=>{b.childNodes[0].nodeValue=n.name,c.classList.add("hidden"),I(n.id)}),c.appendChild(a)}})}catch(r){console.error("Kategoriler alınamadı:",r)}}async function I(e){P(),T(),c.classList.add("hidden");const t=JSON.parse(localStorage.getItem("library"))||[];if(t.length===0){g.style.display="flex",h.innerHTML="",S();return}g.style.display="none",h.innerHTML="",d=[];const r=Number(e);for(const n of t)try{const a=await $(n),s=a.genres?.map(l=>l.id)||a.genre_ids||[];(!e||s.includes(r))&&d.push(a)}catch(a){console.error(`Film ${n} getirilemedi`,a)}u=0,E(),k(),d.length===0&&(g.style.display="flex");const o=new Set;d.forEach(n=>{n.genres?.length?n.genres.forEach(a=>o.add(a.id)):n.genre_ids?.length&&n.genre_ids.forEach(a=>o.add(a))}),await B([...o],r),N(),S()}function E(){const e=u+F;d.slice(u,e).forEach(r=>{const o=V(r,m);h.appendChild(o)}),u=e}function k(){L&&(L.style.display=u>=d.length?"none":"block")}function V(e,t){const r=document.createElement("li");r.classList.add("library-item");const o=e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",n=e.release_date?.split("-")[0]||"Bilinmiyor",a=e.vote_average||0,s=e.genres?.map(p=>p.name).join(", ")||"Tür bilinmiyor",l=K(a);return r.innerHTML=`
    <img src="${o}" alt="${e.title}" class="library-film-poster" />
    <div class="library-overlay">
      <h3 class="library-film-title">${e.title}</h3>
      <div class="library-bottom-row">
        <p class="library-film-info">${s} | ${n}</p>
        <div class="library-stars">${l}</div>
      </div>
    </div>
  `,r.addEventListener("click",()=>{D(e,t)}),r}const w={full:"./svg/star.svg",half:"./svg/star-half.svg",empty:"./svg/star-outline.svg"};function K(e){const t=Math.floor(e/2),r=e%2>=1?1:0,o=5-t-r;return`<img class="star-icon full" src="${w.full}" alt="star" />`.repeat(t)+`<img class="star-icon half" src="${w.half}" alt="half star" />`.repeat(r)+`<img class="star-icon empty" src="${w.empty}" alt="empty star" />`.repeat(o)}function P(){v&&(v.style.display="block")}function S(){v&&(v.style.display="none")}document.addEventListener("DOMContentLoaded",()=>{console.log("Library JS çalışıyor"),b.childNodes[0].nodeValue="Genre",j();const e=document.getElementById("go-to-catalog");e&&e.addEventListener("click",()=>{window.location.href="catalog.html"}),b.addEventListener("click",()=>{c.classList.toggle("hidden")}),L.addEventListener("click",()=>{E(),k()}),document.addEventListener("click",t=>{t.target.closest(".library-custom-select")||c.classList.add("hidden")})});const R=document.querySelectorAll("[data-theme-option]"),H=document.documentElement,q=localStorage.getItem("theme");q&&H.setAttribute("data-theme",q);R.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-theme-option");H.setAttribute("data-theme",t),localStorage.setItem("theme",t)})});async function U(){const e=document.querySelectorAll("load");for(const t of e){const r=t.getAttribute("src");if(r){const o=await fetch(r);if(o.ok){const n=await o.text(),a=document.createElement("div");a.innerHTML=n,t.replaceWith(a)}else console.error("Partial yüklenemedi:",r)}}}U().then(()=>{G()});
//# sourceMappingURL=main-B-6ATEky.js.map
