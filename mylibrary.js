import{f as H,a as $,b as I}from"./assets/scroll-up-CcsXk4-L.js";import"./assets/main-S0yRXnGr.js";async function D(){const e=document.querySelector(".library-hero-bg");if(e)try{const r=(await H())?.results;if(!r||r.length===0)return;const n=r[Math.floor(Math.random()*r.length)]?.backdrop_path;if(n){const a=`https://image.tmdb.org/t/p/w1920${n}`;e.style.backgroundImage=`url('${a}')`,e.style.backgroundSize="cover",e.style.backgroundPosition="center"}}catch(t){console.error("Hero görseli yüklenemedi:",t)}}D();const q=e=>{e.key==="Escape"&&f()};async function G(e,t){let r=document.querySelector("#popup-template");if(!r){const n=window.location.hostname==="localhost",a=n?"":window.location.pathname.split("/")[1],l=n?"/library-popup.html":`/${a}/library-popup.html`;try{const s=await fetch(l);if(!s.ok){console.error(`Popup.html yüklenemedi. Durum: ${s.status}, URL: ${s.url}`);return}const p=await s.text(),g=document.createElement("div");g.innerHTML=p;const i=g.querySelector(".movie-popup-overlay");if(!i){console.error("movie-popup-overlay bulunamadı.");return}i.id="popup-template",document.body.appendChild(i),await x(i,e,t)}catch(s){console.error("Popup yüklenirken bir hata oluştu:",s)}return}const o=r.cloneNode(!0);o.id="",await x(o,e,t)}async function x(e,t,r){e.style.display="flex";const o=e.querySelector(".movie-popup-img");o.src=t.poster_path?`https://image.tmdb.org/t/p/original${t.poster_path}`:"",o.alt=t.title,e.querySelector(".movie-popup-title").textContent=t.title,e.querySelector(".vote-avg").textContent=t.vote_average?.toFixed(1)??"-",e.querySelector(".vote-count").textContent=t.vote_count??"-",e.querySelector(".popularity-value").textContent=t.popularity?.toFixed(1)??"-";let n="-";t.genre_names?.length?n=t.genre_names.join(", "):t.genres?.length?n=t.genres.map(i=>i.name).join(", "):t.genre_ids?.length&&(n=t.genre_ids.map(i=>r[i]||i).join(", ")),e.querySelector(".genre-value").textContent=n,e.querySelector(".about-value").textContent=t.overview||"No description.";const a=e.querySelector(".movie-popup-add-btn.removed");a&&(a.style.display="inline-block",a.onclick=()=>{let i=JSON.parse(localStorage.getItem("library"))||[];i=i.filter(P=>P!==t.id),localStorage.setItem("library",JSON.stringify(i)),f(),window.location.reload()});const l=e.querySelector(".movie-popup-close"),s=window.location.hostname==="localhost",p=s?"":window.location.pathname.split("/")[1],g=s?"":`/${p}`;l.addEventListener("mouseenter",()=>{l.querySelector("img").src=`${g}/img/svg/close-hover.svg`}),l.addEventListener("mouseleave",()=>{l.querySelector("img").src=`${g}/img/svg/close.svg`}),l.addEventListener("click",()=>f()),e.addEventListener("mousedown",i=>{i.target===e&&f()}),document.body.appendChild(e),document.addEventListener("keydown",q)}function f(){const e=document.querySelector(".movie-popup-overlay")||document.querySelector("#popup-template");e&&(e.remove(),document.removeEventListener("keydown",q))}const h=document.getElementById("library-film-list"),y=document.getElementById("library-placeholder"),_=document.querySelector(".library-custom-select"),b=document.querySelector(".library-selected-option"),c=document.querySelector(".library-genre-options"),L=document.getElementById("load-more-btn"),v=document.getElementById("library-loading");let u=null,d=[],m=0;const F=9;function C(){_.style.visibility="visible"}function N(){_.style.visibility="hidden"}async function J(){if(u)return u;const e=await I();return u={},e.genres&&Array.isArray(e.genres)&&e.genres.forEach(t=>{u[t.id]=t.name}),u}async function j(){B(),N(),c.classList.add("hidden");const e=JSON.parse(localStorage.getItem("library"))||[];if(e.length===0){y.style.display="flex",h.innerHTML="",w();return}y.style.display="none",h.innerHTML="",u=await J(),d=[];const t=new Set;for(const r of e)try{const o=await $(r);d.push(o),o.genres?.length?o.genres.forEach(n=>t.add(n.id)):o.genre_ids?.length&&o.genre_ids.forEach(n=>t.add(n))}catch(o){console.error(`Film ${r} getirilemedi`,o)}await T([...t],""),m=0,E(),k(),C(),w()}async function T(e,t=""){try{const o=(await I()).genres;if(c.innerHTML="",t){const n=document.createElement("li");n.textContent="Genre",n.dataset.id="",n.addEventListener("click",()=>{b.childNodes[0].nodeValue="Genre",c.classList.add("hidden"),M("")}),c.appendChild(n)}o.forEach(n=>{if(e.includes(n.id)&&n.id!==Number(t)){const a=document.createElement("li");a.textContent=n.name,a.dataset.id=n.id,a.addEventListener("click",()=>{b.childNodes[0].nodeValue=n.name,c.classList.add("hidden"),M(n.id)}),c.appendChild(a)}})}catch(r){console.error("Kategoriler alınamadı:",r)}}async function M(e){B(),N(),c.classList.add("hidden");const t=JSON.parse(localStorage.getItem("library"))||[];if(t.length===0){y.style.display="flex",h.innerHTML="",w();return}y.style.display="none",h.innerHTML="",d=[];const r=Number(e);for(const n of t)try{const a=await $(n),l=a.genres?.map(s=>s.id)||a.genre_ids||[];(!e||l.includes(r))&&d.push(a)}catch(a){console.error(`Film ${n} getirilemedi`,a)}m=0,E(),k(),d.length===0&&(y.style.display="flex");const o=new Set;d.forEach(n=>{n.genres?.length?n.genres.forEach(a=>o.add(a.id)):n.genre_ids?.length&&n.genre_ids.forEach(a=>o.add(a))}),await T([...o],r),C(),w()}function E(){const e=m+F;d.slice(m,e).forEach(r=>{const o=A(r,u);h.appendChild(o)}),m=e}function k(){L&&(L.style.display=m>=d.length?"none":"block")}function A(e,t){const r=document.createElement("li");r.classList.add("library-item");const o=e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",n=e.release_date?.split("-")[0]||"Bilinmiyor",a=e.vote_average||0,l=e.genres?.map(p=>p.name).join(", ")||"Tür bilinmiyor",s=V(a);return r.innerHTML=`
    <img src="${o}" alt="${e.title}" class="library-film-poster" />
    <div class="library-overlay">
      <h3 class="library-film-title">${e.title}</h3>
      <div class="library-bottom-row">
        <p class="library-film-info">${l} | ${n}</p>
        <div class="library-stars">${s}</div>
      </div>
    </div>
  `,r.addEventListener("click",()=>{G(e,t)}),r}const S={full:"./svg/star.svg",half:"./svg/star-half.svg",empty:"./svg/star-outline.svg"};function V(e){const t=Math.floor(e/2),r=e%2>=1?1:0,o=5-t-r;return`<img class="star-icon full" src="${S.full}" alt="star" />`.repeat(t)+`<img class="star-icon half" src="${S.half}" alt="half star" />`.repeat(r)+`<img class="star-icon empty" src="${S.empty}" alt="empty star" />`.repeat(o)}function B(){v&&(v.style.display="block")}function w(){v&&(v.style.display="none")}document.addEventListener("DOMContentLoaded",()=>{console.log("Library JS çalışıyor"),b.childNodes[0].nodeValue="Genre",j();const e=document.getElementById("go-to-catalog");e&&e.addEventListener("click",()=>{window.location.href="catalog.html"}),b.addEventListener("click",()=>{c.classList.toggle("hidden")}),L.addEventListener("click",()=>{E(),k()}),document.addEventListener("click",t=>{t.target.closest(".library-custom-select")||c.classList.add("hidden")})});
//# sourceMappingURL=mylibrary.js.map
