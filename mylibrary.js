import{f as P,a as I,b as q}from"./assets/scroll-up-CLPXUGzI.js";import"./assets/main-S0yRXnGr.js";async function H(){const e=document.querySelector(".library-hero-bg");if(e)try{const o=(await P())?.results;if(!o||o.length===0)return;const n=o[Math.floor(Math.random()*o.length)]?.backdrop_path;if(n){const a=`https://image.tmdb.org/t/p/w1920${n}`;e.style.backgroundImage=`url('${a}')`,e.style.backgroundSize="cover",e.style.backgroundPosition="center"}}catch(t){console.error("Hero görseli yüklenemedi:",t)}}H();const _=e=>{e.key==="Escape"&&f()};async function D(e,t){let o=document.querySelector("#popup-template");if(!o){const n=window.location.hostname==="localhost",a=n?"":window.location.pathname.split("/")[1],s=n?"/library-popup.html":`/${a}/library-popup.html`;try{const l=await fetch(s);if(!l.ok){console.error(`Popup.html yüklenemedi. Durum: ${l.status}, URL: ${l.url}`);return}const i=await l.text(),g=document.createElement("div");g.innerHTML=i;const h=g.querySelector(".movie-popup-overlay");if(!h){console.error("movie-popup-overlay bulunamadı.");return}h.id="popup-template",document.body.appendChild(h),await x(h,e,t)}catch(l){console.error("Popup yüklenirken bir hata oluştu:",l)}return}const r=o.cloneNode(!0);r.id="",await x(r,e,t)}async function x(e,t,o){e.style.display="flex";const r=e.querySelector(".movie-popup-img");r.src=t.poster_path?`https://image.tmdb.org/t/p/original${t.poster_path}`:"",r.alt=t.title,e.querySelector(".movie-popup-title").textContent=t.title,e.querySelector(".vote-avg").textContent=t.vote_average?.toFixed(1)??"-",e.querySelector(".vote-count").textContent=t.vote_count??"-",e.querySelector(".popularity-value").textContent=t.popularity?.toFixed(1)??"-";let n="-";t.genre_names?.length?n=t.genre_names.join(", "):t.genres?.length?n=t.genres.map(i=>i.name).join(", "):t.genre_ids?.length&&(n=t.genre_ids.map(i=>o[i]||i).join(", ")),e.querySelector(".genre-value").textContent=n,e.querySelector(".about-value").textContent=t.overview||"No description.";const a=e.querySelector(".movie-popup-add-btn.removed");a&&(a.style.display="inline-block",a.onclick=()=>{let i=JSON.parse(localStorage.getItem("library"))||[];i=i.filter(g=>g!==t.id),localStorage.setItem("library",JSON.stringify(i)),f(),window.location.reload()});const s=e.querySelector(".movie-popup-close");window.location.hostname==="localhost"||window.location.pathname.split("/")[1],s.addEventListener("mouseenter",()=>{const i=s.querySelector(".close-icon");i&&i.classList.add("hovered")}),s.addEventListener("mouseleave",()=>{const i=s.querySelector(".close-icon");i&&i.classList.remove("hovered")}),s.addEventListener("click",()=>f()),e.addEventListener("mousedown",i=>{i.target===e&&f()}),document.body.appendChild(e),document.addEventListener("keydown",_)}function f(){const e=document.querySelector(".movie-popup-overlay")||document.querySelector("#popup-template");e&&(e.remove(),document.removeEventListener("keydown",_))}const y=document.getElementById("library-film-list"),p=document.getElementById("library-placeholder"),$=document.querySelector(".library-custom-select"),b=document.querySelector(".library-selected-option"),c=document.querySelector(".library-genre-options"),S=document.getElementById("load-more-btn"),L=document.getElementById("library-loading");let u=null,d=[],m=0;const G=9;function C(){$.style.visibility="visible"}function N(){$.style.visibility="hidden"}async function F(){if(u)return u;const e=await q();return u={},e.genres&&Array.isArray(e.genres)&&e.genres.forEach(t=>{u[t.id]=t.name}),u}async function J(){B(),N(),c.classList.add("hidden");const e=JSON.parse(localStorage.getItem("library"))||[];if(e.length===0){p.style.display="flex",y.innerHTML="",v();return}p.style.display="none",y.innerHTML="",u=await F(),d=[];const t=new Set;for(const o of e)try{const r=await I(o);d.push(r),r.genres?.length?r.genres.forEach(n=>t.add(n.id)):r.genre_ids?.length&&r.genre_ids.forEach(n=>t.add(n))}catch(r){console.error(`Film ${o} getirilemedi`,r)}await T([...t],""),m=0,E(),k(),C(),v()}async function T(e,t=""){try{const r=(await q()).genres;if(c.innerHTML="",t){const n=document.createElement("li");n.textContent="Genre",n.dataset.id="",n.addEventListener("click",()=>{b.childNodes[0].nodeValue="Genre",c.classList.add("hidden"),M("")}),c.appendChild(n)}r.forEach(n=>{if(e.includes(n.id)&&n.id!==Number(t)){const a=document.createElement("li");a.textContent=n.name,a.dataset.id=n.id,a.addEventListener("click",()=>{b.childNodes[0].nodeValue=n.name,c.classList.add("hidden"),M(n.id)}),c.appendChild(a)}})}catch(o){console.error("Kategoriler alınamadı:",o)}}async function M(e){B(),N(),c.classList.add("hidden");const t=JSON.parse(localStorage.getItem("library"))||[];if(t.length===0){p.style.display="flex",y.innerHTML="",v();return}p.style.display="none",y.innerHTML="",d=[];const o=Number(e);for(const n of t)try{const a=await I(n),s=a.genres?.map(l=>l.id)||a.genre_ids||[];(!e||s.includes(o))&&d.push(a)}catch(a){console.error(`Film ${n} getirilemedi`,a)}m=0,E(),k(),d.length===0&&(p.style.display="flex");const r=new Set;d.forEach(n=>{n.genres?.length?n.genres.forEach(a=>r.add(a.id)):n.genre_ids?.length&&n.genre_ids.forEach(a=>r.add(a))}),await T([...r],o),C(),v()}function E(){const e=m+G;d.slice(m,e).forEach(o=>{const r=j(o,u);y.appendChild(r)}),m=e}function k(){S&&(S.style.display=m>=d.length?"none":"block")}function j(e,t){const o=document.createElement("li");o.classList.add("library-item");const r=e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",n=e.release_date?.split("-")[0]||"Bilinmiyor",a=e.vote_average||0,s=e.genres?.map(i=>i.name).join(", ")||"Tür bilinmiyor",l=A(a);return o.innerHTML=`
    <img src="${r}" alt="${e.title}" class="library-film-poster" />
    <div class="library-overlay">
      <h3 class="library-film-title">${e.title}</h3>
      <div class="library-bottom-row">
        <p class="library-film-info">${s} | ${n}</p>
        <div class="library-stars">${l}</div>
      </div>
    </div>
  `,o.addEventListener("click",()=>{D(e,t)}),o}const w={full:"./svg/star.svg",half:"./svg/star-half.svg",empty:"./svg/star-outline.svg"};function A(e){const t=Math.floor(e/2),o=e%2>=1?1:0,r=5-t-o;return`<img class="star-icon full" src="${w.full}" alt="star" />`.repeat(t)+`<img class="star-icon half" src="${w.half}" alt="half star" />`.repeat(o)+`<img class="star-icon empty" src="${w.empty}" alt="empty star" />`.repeat(r)}function B(){L&&(L.style.display="block")}function v(){L&&(L.style.display="none")}document.addEventListener("DOMContentLoaded",()=>{console.log("Library JS çalışıyor"),b.childNodes[0].nodeValue="Genre",J();const e=document.getElementById("go-to-catalog");e&&e.addEventListener("click",()=>{window.location.href="catalog.html"}),b.addEventListener("click",()=>{c.classList.toggle("hidden")}),S.addEventListener("click",()=>{E(),k()}),document.addEventListener("click",t=>{t.target.closest(".library-custom-select")||c.classList.add("hidden")})});
//# sourceMappingURL=mylibrary.js.map
